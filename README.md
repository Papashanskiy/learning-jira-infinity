# Автоматизация управления задачами Jira

## Описание проекта

Система реализует автономное управление жизненным циклом задач в Jira, обеспечивая их автоматическое перемещение в статус «In Progress» в начале рабочего дня в соответствии с индивидуальным расписанием проектов. При отсутствии активных задач в бэклоге производится генерация новых обучающих задач с помощью языковой модели Groq (Llama), что позволяет непрерывно пополнять пул задач для повышения квалификации. Все действия фиксируются и могут быть направлены в корпоративный мессенджер или систему логирования.

## Возможности

- Централизованная оркестрация задач в Jira на основе временных триггеров и проектных расписаний
- Автоматическое выявление дефицита активных задач и их восполнение через генерацию учебных тем
- Интеграция уведомлений о статусе выполнения в корпоративный мессенджер или систему логов
- Поддержка dry-run режима для безопасного тестирования
- Расширяемая архитектура и покрытие unit/integration тестами

## Установка и запуск

1. **Создайте виртуальное окружение и активируйте его:**
    ```bash
    python -m venv venv
    source venv/bin/activate  # для Linux/Mac
    # или
    .\venv\Scripts\activate  # для Windows
    ```

2. **Установите зависимости:**
    ```bash
    pip install -r core/requirements.txt
    ```

3. **Создайте файл `.env` в корневой директории и заполните его:**
    ```
    JIRA_URL=https://your-domain.atlassian.net
    JIRA_USER=your-email@example.com
    JIRA_TOKEN=your-jira-api-token
    GROQ_API_KEY=your-groq-api-key
    JIRA_BOARD_ID=your-board-id
    JIRA_PROJECT_KEY=PRO
    # Планировщик (опционально)
    SCHEDULER_TIMEZONE=Asia/Almaty
    SCHEDULER_HOUR=8
    SCHEDULER_MINUTE=0
    SCHEDULER_DAYS=mon-fri
    # Для dry-run режима
    DRY_RUN=true
    ```

4. **Для тестового запуска (dry-run):**
    ```bash
    export DRY_RUN=true
    python core/main.py
    ```

5. **Для запуска планировщика в обычном режиме:**
    ```bash
    export DRY_RUN=false
    python core/main.py
    ```

## Тестирование

### Unit-тесты

- Покрывают ключевые функции: генерация задач, переходы статусов, работу с Jira и Groq.
- Запуск:
    ```bash
    pytest tests/test_main.py
    ```

### Интеграционные тесты

- Проверяют сценарии создания задач, идемпотентность, обработку ошибок и работу планировщика.
- Запуск:
    ```bash
    pytest tests/test_integration_main.py
    ```

### Общий запуск всех тестов

```bash
pytest tests/
```

## Dry-run режим

Для безопасного тестирования используйте переменную окружения `DRY_RUN=true`.  
В этом режиме задачи не создаются и не изменяются, а действия только логируются.

## Примечания

- Для корректной работы убедитесь, что в папках `core` и `tests` есть файлы `__init__.py`.
- Для поддержки таймзоны требуется пакет `pytz`.
- Для ретраев используется пакет `tenacity`.
- Для работы с Jira необходимы права на создание и изменение задач.
- Для интеграции с корпоративным мессенджером реализуйте функцию `notify_critical_error`.

---
